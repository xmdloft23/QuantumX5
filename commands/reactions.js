import configManager from '../utils/manageConfigs.js';
import channelSender from '../commands/channelSender.js';

// Expanded emoji pool
const EMOJI_POOL = [
  'üëª', 'üòπ', 'ü©∏', 'üí¶', 'üíî', 'üí´', 'üòÉ',
  'üòÇ', 'üòç', 'üòé', 'ü•≥', 'ü§ì', 'üòú', 'üò∫',
  'üåü', '‚ú®', 'üî•', 'üçÄ', 'üíö', 'üíñ', 'üéâ',
  'üòª', 'ü•∞', 'üòá', 'ü§©', 'üôÄ', 'üí•', '‚ö°Ô∏è',
  'üòÄ', 'üòÑ', 'üòä', 'üòã', 'üòò', 'üòó', 'üòö',
  'üòè', 'üòí', 'üò£', 'üò•', 'üò™', 'üò´', 'üò¥',
  'üò∑', 'ü§ó', 'ü§î', 'ü§§', 'ü§¢', 'ü§ß', 'üò§',
  'üòµ', 'üòà', 'üëø', 'ü§°', 'üëΩ', 'üëæ', 'ü§ñ',
  'üéÉ', 'üòø', 'üòæ', 'üôà', 'üôâ', 'üôä', 'üíã',
  'üíå', 'üí§', 'üë∂', 'üëß', 'üë¶', 'üë©', 'üë®',
  'üëµ', 'üë¥', 'üë©‚Äç‚öïÔ∏è', 'üë®‚Äç‚öïÔ∏è', 'üë©‚Äçüéì', 'üë®‚Äçüéì',
  'üë©‚Äçüè´', 'üë®‚Äçüè´', 'üë©‚Äç‚öñÔ∏è', 'üë®‚Äç‚öñÔ∏è', 'üë©‚Äçüåæ', 'üë®‚Äçüåæ',
  'üë©‚Äçüç≥', 'üë®‚Äçüç≥', 'üë©‚Äçüîß', 'üë®‚Äçüîß', 'üë©‚Äçüè≠', 'üë®‚Äçüè≠',
  'üë©‚Äçüíº', 'üë®‚Äçüíº', 'üë©‚Äçüî¨', 'üë®‚Äçüî¨', 'üë©‚Äçüíª', 'üë®‚Äçüíª',
  'üë©‚Äçüé§', 'üë®‚Äçüé§', 'üë©‚Äçüé®', 'üë®‚Äçüé®', 'üë©‚Äç‚úàÔ∏è', 'üë®‚Äç‚úàÔ∏è',
  'üë©‚ÄçüöÄ', 'üë®‚ÄçüöÄ', 'üë©‚Äçüöí', 'üë®‚Äçüöí', 'üëÆ‚Äç‚ôÄÔ∏è', 'üëÆ‚Äç‚ôÇÔ∏è',
  'üïµÔ∏è‚Äç‚ôÄÔ∏è', 'üïµÔ∏è‚Äç‚ôÇÔ∏è', 'üíÇ‚Äç‚ôÄÔ∏è', 'üíÇ‚Äç‚ôÇÔ∏è', 'üë∑‚Äç‚ôÄÔ∏è', 'üë∑‚Äç‚ôÇÔ∏è',
  'üë∏', 'ü§¥', 'üë≥‚Äç‚ôÄÔ∏è', 'üë≥‚Äç‚ôÇÔ∏è', 'üßï', 'üßë‚Äçü¶∞', 'üßë‚Äçü¶±',
  'üßë‚Äçü¶≥', 'üßë‚Äçü¶≤', 'üßî', 'üë±‚Äç‚ôÄÔ∏è', 'üë±‚Äç‚ôÇÔ∏è', 'üßô‚Äç‚ôÄÔ∏è', 'üßô‚Äç‚ôÇÔ∏è',
  'üßù‚Äç‚ôÄÔ∏è', 'üßù‚Äç‚ôÇÔ∏è', 'üßö‚Äç‚ôÄÔ∏è', 'üßö‚Äç‚ôÇÔ∏è', 'üßú‚Äç‚ôÄÔ∏è', 'üßú‚Äç‚ôÇÔ∏è',
  'üßû‚Äç‚ôÄÔ∏è', 'üßû‚Äç‚ôÇÔ∏è', 'üßü‚Äç‚ôÄÔ∏è', 'üßü‚Äç‚ôÇÔ∏è', 'üôç‚Äç‚ôÄÔ∏è', 'üôç‚Äç‚ôÇÔ∏è',
  'üôé‚Äç‚ôÄÔ∏è', 'üôé‚Äç‚ôÇÔ∏è', 'üôÖ‚Äç‚ôÄÔ∏è', 'üôÖ‚Äç‚ôÇÔ∏è', 'üôÜ‚Äç‚ôÄÔ∏è', 'üôÜ‚Äç‚ôÇÔ∏è',
  'üíÅ‚Äç‚ôÄÔ∏è', 'üíÅ‚Äç‚ôÇÔ∏è', 'üôã‚Äç‚ôÄÔ∏è', 'üôã‚Äç‚ôÇÔ∏è', 'üßè‚Äç‚ôÄÔ∏è', 'üßè‚Äç‚ôÇÔ∏è',
  'üôá‚Äç‚ôÄÔ∏è', 'üôá‚Äç‚ôÇÔ∏è', 'ü§¶‚Äç‚ôÄÔ∏è', 'ü§¶‚Äç‚ôÇÔ∏è', 'ü§∑‚Äç‚ôÄÔ∏è', 'ü§∑‚Äç‚ôÇÔ∏è',
  'üíÜ‚Äç‚ôÄÔ∏è', 'üíÜ‚Äç‚ôÇÔ∏è', 'üíá‚Äç‚ôÄÔ∏è', 'üíá‚Äç‚ôÇÔ∏è', 'üö∂‚Äç‚ôÄÔ∏è', 'üö∂‚Äç‚ôÇÔ∏è',
  'üèÉ‚Äç‚ôÄÔ∏è', 'üèÉ‚Äç‚ôÇÔ∏è', 'üíÉ', 'üï∫', 'üëØ‚Äç‚ôÄÔ∏è', 'üëØ‚Äç‚ôÇÔ∏è', 'üßñ‚Äç‚ôÄÔ∏è',
  'üßñ‚Äç‚ôÇÔ∏è', 'üßó‚Äç‚ôÄÔ∏è', 'üßó‚Äç‚ôÇÔ∏è', 'üèÑ‚Äç‚ôÄÔ∏è', 'üèÑ‚Äç‚ôÇÔ∏è', 'üèä‚Äç‚ôÄÔ∏è',
  'üèä‚Äç‚ôÇÔ∏è', 'üö¥‚Äç‚ôÄÔ∏è', 'üö¥‚Äç‚ôÇÔ∏è', 'üöµ‚Äç‚ôÄÔ∏è', 'üöµ‚Äç‚ôÇÔ∏è', 'ü§∏‚Äç‚ôÄÔ∏è',
  'ü§∏‚Äç‚ôÇÔ∏è', 'ü§Ω‚Äç‚ôÄÔ∏è', 'ü§Ω‚Äç‚ôÇÔ∏è', 'ü§æ‚Äç‚ôÄÔ∏è', 'ü§æ‚Äç‚ôÇÔ∏è', 'ü§π‚Äç‚ôÄÔ∏è',
  'ü§π‚Äç‚ôÇÔ∏è', 'üßò‚Äç‚ôÄÔ∏è', 'üßò‚Äç‚ôÇÔ∏è', 'üê∂', 'üê±', 'üê≠', 'üêπ',
  'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ', 'ü¶Å', 'üêÆ',
  'üê∑', 'üê∏', 'üêµ', 'üêî', 'üêß', 'üê¶', 'üê§', 'ü¶Ñ',
  'üêù', 'ü¶ã', 'üêû', 'üêç', 'üê¢', 'ü¶é', 'üêô', 'ü¶ë',
  'ü¶ê', 'ü¶Ä', 'üê†', 'üêü', 'üê¨', 'üê≥', 'ü¶à', 'üêä',
  'üêò', 'ü¶í', 'ü¶ì', 'ü¶è', 'ü¶ç', 'ü¶í', 'ü¶ú', 'ü¶ö',
  '‚ö∞Ô∏è', '‚òÄÔ∏è', 'üåô', '‚òÅÔ∏è', '‚õÖ', '‚õàÔ∏è', '‚ùÑÔ∏è', '‚òî',
  'üåä', 'üåã', 'üåÑ', 'üåÖ', 'üåå', 'üçé', 'üçê', 'üçä',
  'üçã', 'üçå', 'üçâ', 'üçá', 'üçì', 'üçí', 'üçë', 'ü•≠',
  'üçç', 'ü••', 'ü•ù', 'üçÖ', 'ü•ë', 'ü•ï', 'üåΩ', 'ü•î',
  'üç†', 'ü•ê', 'üçû', 'ü•ñ', 'ü•®', 'üßÄ', 'ü•ö', 'üç≥',
  'ü•û', 'üßá', 'ü•ì', 'ü•©', 'üçó', 'üçî', 'üçü', 'üçï',
  'üåÆ', 'üåØ', 'ü•ó', 'üçù', 'üçú', 'üç£', 'üç§', 'üç¶',
  'üç∞', 'üéÇ', 'üç´', 'üç¨', 'üç≠', 'üçÆ', '‚òï', 'üçµ',
  'ü•§', 'üç∑', 'üç∫', 'üçπ', 'ü•Ç', 'üéÅ', 'üéà', 'üéä',
  'üß®', 'üéÜ', 'üéá', 'üéÑ', 'üéÖ', 'ü¶å', '‚õÑ', '‚ùó',
  '‚ÅâÔ∏è', '‚ÄºÔ∏è', '‚úîÔ∏è', '‚úÖ', '‚ùå', '‚û°Ô∏è', '‚¨ÖÔ∏è', '‚¨ÜÔ∏è',
  '‚¨áÔ∏è', 'üîÑ', 'üîú', 'üîù', 'üîî', 'üîï', 'üéµ', 'üé∂',
  'üì£', 'üì¢', 'üí¨', 'üóØÔ∏è', 'üí≠', 'üîç', 'üîé', 'üîí',
  'üîì', 'üóùÔ∏è', 'üí°', 'üìö', 'üìñ', 'üñäÔ∏è', '‚úèÔ∏è', 'üìù',
  'üñåÔ∏è', 'üé®', 'üì∏', 'üé•', 'üé¨', 'üé§', 'üéß', 'üéÆ',
  'üé≤', 'üß©', 'üèÜ', 'üéñÔ∏è', 'üèÖ', 'ü•á', 'ü•à', 'ü•â',
  '‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'üéæ', 'üèê', 'üèâ', 'üé±',
  'üèì', 'üè∏', 'ü•ä', 'ü•ã', '‚õ≥', '‚õ∏Ô∏è', 'üéø', 'üõ∑',
  'ü™Å', 'üèπ', 'üé£', 'ü§ø', 'üõπ', 'üõº', 'üöó', 'üöï',
  'üöô', 'üöå', 'üöé', 'üöí', 'üöë', 'üöì', 'üöö', 'üöú',
  'üö≤', 'üõµ', 'üèçÔ∏è', 'üõ∫', '‚úàÔ∏è', 'üöÅ', 'üõ∂', '‚õµ',
  'üö§', 'üõ≥Ô∏è', 'üöÄ', 'üõ∞Ô∏è', 'üõ∏', '‚è∞', '‚è≥', '‚åõ',
  'üï∞Ô∏è', 'üåç', 'üåé', 'üåè', 'üó∫Ô∏è', 'üèîÔ∏è', '‚õ∞Ô∏è', 'üèïÔ∏è',
  'üèñÔ∏è', 'üèúÔ∏è', 'üèùÔ∏è', 'üèûÔ∏è', 'üè∞', 'üèØ', 'üóº', 'üóΩ',
  '‚õ™', 'üïå', 'üïç', 'üõï', '‚õ©Ô∏è', 'üè¨', 'üè≠', 'üè†',
  'üè°', 'üè¢', 'üè£', 'üè§', 'üè•', 'üè¶', 'üè®', 'üè©',
  'üè™', 'üè´', 'üèõÔ∏è', 'üèüÔ∏è', 'üè§', 'üõ†Ô∏è', 'üîß', 'üî®',
  '‚öôÔ∏è', 'ü™ö', 'üî©', 'ü™ú', 'üß∞', 'üß≤', 'üß™', 'üß¨',
  'üî¨', 'üî≠', 'üì°', 'üíâ', 'ü©∫', 'ü©π', 'ü©º', 'üö™',
  'üõèÔ∏è', 'üõãÔ∏è', 'ü™ë', 'üöΩ', 'üõÅ', 'üõí', 'üß∫', 'üßª',
  'üßº', 'ü™•', 'üßΩ', 'üß¥', 'üßπ', 'ü™£', 'ü™û', 'ü™ü'
];

// Function to get random emoji
const getRandomEmoji = () => {
  return EMOJI_POOL[Math.floor(Math.random() * EMOJI_POOL.length)];
};

// Simple emoji regex (works for most cases)
function isEmoji(str) {
  const emojiRegex = /^(?:\p{Emoji_Presentation}|\p{Extended_Pictographic})$/u;
  return emojiRegex.test(str);
}

export async function auto(message, client, cond) {
  try {
    const remoteJid = message.key?.remoteJid;
    
    if (!remoteJid) {
      throw new Error("Message JID is undefined");
    }

    if (cond) {
      await client.sendMessage(remoteJid, {
        react: {
          text: getRandomEmoji(),
          key: message.key
        }
      });
    }
  } catch (error) {
    console.error('Error in auto react:', error);
    // Silently fail to avoid spamming users with error messages
  }
}

export async function autoreact(message, client) {
  const number = client.user.id.split(':')[0];
  const remoteJid = message.key?.remoteJid;

  try {
    if (!remoteJid) {
      throw new Error("Message JID is undefined");
    }

    const messageBody = 
      message.message?.extendedTextMessage?.text ||
      message.message?.conversation ||
      '';

    if (!messageBody.startsWith('!autoreact')) {
      return;
    }

    const commandAndArgs = messageBody.slice(1).trim();
    const parts = commandAndArgs.split(/\s+/);
    const args = parts.slice(1);

    if (args.length === 0) {
      throw new Error("Please provide 'on' or 'off'");
    }

    const input = args[0].toLowerCase();

    // Initialize user config if it doesn't exist
    if (!configManager.config.users[number]) {
      configManager.config.users[number] = { autoreact: false };
    }

    const userConfig = configManager.config.users[number];

    if (input === 'on' || input === 'off') {
      userConfig.autoreact = input === 'on';
      configManager.save();
      
      await channelSender(
        message,
        client,
        `Auto-react has been turned *${input.toUpperCase()}*. Will use random emojis from a pool of ${EMOJI_POOL.length} emojis.`,
        3
      );
    } else {
      await client.sendMessage(remoteJid, {
        text: "*Please use: !autoreact on|off*"
      });
    }
  } catch (error) {
    await client.sendMessage(remoteJid, {
      text: `‚ùå Error: ${error.message}. Usage: !autoreact on|off`
    });
  }
}

export default { auto, autoreact };